<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload de Arquivos - Tratamento de Dados</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4a5568;
            --primary-hover: #2d3748;
            --secondary-color: #64748b;
            --background: #f8fafc;
            --card-background: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --success-color: #10b981;
            --error-color: #ef4444;
            --info-color: #3b82f6;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .header {
            background: var(--card-background);
            border-bottom: 1px solid var(--border-color);
            padding: 1.25rem 2rem;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* ========== TELA 1: UPLOAD ========== */
        .upload-screen {
            display: block;
        }

        .upload-screen.hidden {
            display: none;
        }

        .upload-card {
            background: var(--card-background);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-header h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .card-header p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .file-counter {
            display: inline-block;
            margin-left: 0.5rem;
            padding: 0.125rem 0.5rem;
            background: var(--primary-color);
            color: white;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .card-content {
            padding: 1.5rem;
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            background: var(--background);
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(74, 85, 104, 0.02);
        }

        .upload-area.drag-over {
            border-color: var(--primary-color);
            background: rgba(74, 85, 104, 0.05);
            transform: scale(1.01);
        }

        .upload-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1rem;
            background: rgba(74, 85, 104, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upload-icon svg {
            width: 32px;
            height: 32px;
            color: var(--primary-color);
        }

        .upload-text h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .upload-text p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .file-types {
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        #fileInput {
            display: none;
        }

        .files-list {
            display: none;
            margin-top: 1rem;
        }

        .files-list.active {
            display: block;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: var(--background);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .file-item:hover {
            border-color: var(--primary-color);
        }

        .file-icon {
            width: 36px;
            height: 36px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .file-icon svg {
            width: 20px;
            height: 20px;
            color: var(--success-color);
        }

        .file-info {
            flex: 1;
            min-width: 0;
        }

        .file-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-size {
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        .remove-file {
            width: 28px;
            height: 28px;
            border: none;
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .remove-file:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .remove-file svg {
            width: 16px;
            height: 16px;
        }

        .alert {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .alert svg {
            width: 20px;
            height: 20px;
            color: var(--info-color);
            flex-shrink: 0;
        }

        .alert span {
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .btn {
            flex: 1;
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--background);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(74, 85, 104, 0.05);
        }

        /* ========== TELA 2: PROCESSAMENTO ========== */
        .processing-screen {
            display: none;
            text-align: center;
        }

        .processing-screen.active {
            display: block;
        }

        .processing-card {
            background: var(--card-background);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            padding: 4rem 2rem;
        }

        .spinner {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-text {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .processing-subtext {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .processing-counter {
            font-size: 1rem;
            color: var(--info-color);
            font-weight: 500;
        }

        /* ========== TELA 3: RESULTADOS ========== */
        .results-screen {
            display: none;
        }

        .results-screen.active {
            display: block;
        }

        .results-card {
            background: var(--card-background);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .success-header {
            padding: 1.5rem;
            background: rgba(16, 185, 129, 0.1);
            border-bottom: 1px solid rgba(16, 185, 129, 0.2);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .success-icon {
            width: 48px;
            height: 48px;
            background: var(--success-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .success-icon svg {
            width: 28px;
            height: 28px;
            color: white;
        }

        .success-content h2 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .success-content p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .results-content {
            padding: 1.5rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--background);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .result-icon {
            width: 40px;
            height: 40px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .result-icon svg {
            width: 22px;
            height: 22px;
            color: var(--info-color);
        }

        .result-details {
            flex: 1;
            min-width: 0;
        }

        .result-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-bottom: 0.25rem;
        }

        .result-size {
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        .result-actions {
            display: flex;
            gap: 0.75rem;
        }

        @media (max-width: 640px) {
            .container {
                padding: 0 1rem;
            }

            .files-grid,
            .results-grid {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üìä</div>
                <span>Tratamento de Dados</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- ========== TELA 1: UPLOAD ========== -->
        <div class="upload-screen" id="uploadScreen">
            <div class="upload-card">
                <div class="card-header">
                    <h2>Selecione os Arquivos <span class="file-counter" id="fileCounter">0/8</span></h2>
                    <p>Arraste arquivos ou clique para selecionar</p>
                </div>
                <div class="card-content">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                        </div>
                        <div class="upload-text">
                            <h3>Clique para selecionar arquivos</h3>
                            <p>ou arraste e solte aqui</p>
                            <p class="file-types">Formatos aceitos: .xlsx, .xls (m√°ximo 8 arquivos)</p>
                        </div>
                    </div>
                    <input type="file" id="fileInput" multiple accept=".xlsx,.xls">

                    <div class="files-list" id="filesList">
                        <div class="alert" id="infoAlert">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                            </svg>
                            <span>Adicione at√© 8 arquivos Excel para processamento simult√¢neo!</span>
                        </div>
                        <div class="files-grid" id="filesGrid"></div>
                        <div class="actions">
                            <button class="btn btn-secondary" id="cancelBtn" style="display: none;">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                                <span>Cancelar</span>
                            </button>
                            <button class="btn btn-secondary" id="addMoreBtn" style="display: none;">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                                <span>Adicionar Mais</span>
                            </button>
                            <button class="btn btn-primary" id="uploadBtn" disabled>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                </svg>
                                <span id="uploadBtnText">Processar Arquivos</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== TELA 2: PROCESSAMENTO ========== -->
        <div class="processing-screen" id="processingScreen">
            <div class="processing-card">
                <div class="spinner"></div>
                <div class="processing-text" id="processingText">Enviando arquivos para processamento...</div>
                <div class="processing-subtext">Aguardando resposta do N8N. Isso pode levar alguns instantes.</div>
                <div class="processing-counter" id="processingCounter"></div>
            </div>
        </div>

        <!-- ========== TELA 3: RESULTADOS ========== -->
        <div class="results-screen" id="resultsScreen">
            <div class="results-card">
                <div class="success-header">
                    <div class="success-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    <div class="success-content">
                        <h2 id="successTitle">Processamento Conclu√≠do!</h2>
                        <p id="successMessage">Todos os arquivos foram recebidos do N8N</p>
                    </div>
                </div>
                <div class="results-content">
                    <div class="results-grid" id="resultsGrid"></div>
                    <div class="result-actions">
                        <button class="btn btn-primary" id="newUploadBtn">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            <span>Novo Processamento</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const MAX_FILES = 8;
        let selectedFiles = [];
        let processedFiles = [];
        let expectedFilesCount = 0;

        // Elementos da DOM
        const uploadScreen = document.getElementById('uploadScreen');
        const processingScreen = document.getElementById('processingScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const filesList = document.getElementById('filesList');
        const filesGrid = document.getElementById('filesGrid');
        const fileCounter = document.getElementById('fileCounter');
        const infoAlert = document.getElementById('infoAlert');
        const uploadBtn = document.getElementById('uploadBtn');
        const uploadBtnText = document.getElementById('uploadBtnText');
        const cancelBtn = document.getElementById('cancelBtn');
        const addMoreBtn = document.getElementById('addMoreBtn');
        
        const processingText = document.getElementById('processingText');
        const processingCounter = document.getElementById('processingCounter');
        
        const resultsGrid = document.getElementById('resultsGrid');
        const successMessage = document.getElementById('successMessage');
        const newUploadBtn = document.getElementById('newUploadBtn');

        // Event Listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        addMoreBtn.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            const files = Array.from(e.dataTransfer.files);
            addFiles(files);
        });

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            addFiles(files);
            fileInput.value = '';
        }

        function addFiles(files) {
            const validFiles = files.filter(file => {
                const ext = file.name.toLowerCase();
                return ext.endsWith('.xlsx') || ext.endsWith('.xls');
            });

            const remainingSlots = MAX_FILES - selectedFiles.length;
            const filesToAdd = validFiles.slice(0, remainingSlots);

            selectedFiles = [...selectedFiles, ...filesToAdd];
            updateFilesList();

            if (validFiles.length > filesToAdd.length) {
                alert(`‚ö†Ô∏è Limite de ${MAX_FILES} arquivos atingido. ${validFiles.length - filesToAdd.length} arquivo(s) n√£o foram adicionados.`);
            }
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFilesList();
        }

        function updateFilesList() {
            fileCounter.textContent = `${selectedFiles.length}/${MAX_FILES}`;

            if (selectedFiles.length > 0) {
                filesList.classList.add('active');
                uploadArea.style.display = 'none';
                uploadBtn.disabled = false;
                addMoreBtn.style.display = selectedFiles.length < MAX_FILES ? 'flex' : 'none';
                cancelBtn.style.display = 'flex';

                filesGrid.innerHTML = selectedFiles.map((file, index) => `
                    <div class="file-item">
                        <div class="file-icon">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="file-info">
                            <div class="file-name" title="${file.name}">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                        <button class="remove-file" onclick="removeFile(${index})" title="Remover arquivo">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                `).join('');

                if (selectedFiles.length === 1) {
                    infoAlert.innerHTML = `
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        <span>1 arquivo pronto. Adicione at√© ${MAX_FILES - 1} arquivos adicionais para processamento paralelo!</span>
                    `;
                    uploadBtnText.textContent = 'Processar Arquivo';
                } else {
                    infoAlert.innerHTML = `
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        <span>${selectedFiles.length} arquivos prontos para processamento simult√¢neo! ‚ö°</span>
                    `;
                    uploadBtnText.textContent = 'Processar Arquivos';
                }
            } else {
                resetForm();
            }
        }

        cancelBtn.addEventListener('click', () => {
            if (confirm('Deseja limpar todos os arquivos selecionados?')) {
                selectedFiles = [];
                resetForm();
            }
        });

        uploadBtn.addEventListener('click', async () => {
            if (selectedFiles.length === 0) return;

            // O N8N sempre retorna 1 arquivo (ZIP se m√∫ltiplos, ou Excel se √∫nico)
            expectedFilesCount = 1;
            processedFiles = [];

            // Transi√ß√£o para tela de processamento
            showProcessingScreen();

            const formData = new FormData();
            selectedFiles.forEach((file, index) => {
                formData.append(`file${index + 1}`, file);
            });

            try {
                const webhookURL = 'https://projeto-teste-n8n.ly7t0m.easypanel.host/webhook/processar-8-arquivos';
                
                processingText.textContent = 'Enviando arquivos para o N8N...';
                updateProcessingCounter();

                const response = await fetch(webhookURL, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    processingText.textContent = 'Recebendo resposta do N8N...';
                    
                    const blob = await response.blob();
                    const contentType = response.headers.get('content-type');
                    
                    // Pega o nome do arquivo do header ou usa nome padr√£o
                    const contentDisposition = response.headers.get('content-disposition');
                    let fileName = 'arquivo_processado.xlsx';
                    
                    if (contentDisposition) {
                        const fileNameMatch = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);
                        if (fileNameMatch && fileNameMatch[1]) {
                            fileName = fileNameMatch[1].replace(/['"]/g, '');
                        }
                    } else if (contentType) {
                        // Define nome baseado no tipo
                        if (contentType.includes('zip')) {
                            fileName = `processados_${new Date().toISOString().split('T')[0]}.zip`;
                        } else if (contentType.includes('excel') || contentType.includes('spreadsheet')) {
                            fileName = 'arquivo_processado.xlsx';
                        }
                    }
                    
                    // Adiciona o arquivo recebido
                    processedFiles.push({
                        name: fileName,
                        size: blob.size,
                        type: contentType || 'application/octet-stream'
                    });
                    
                    processingText.textContent = 'Arquivo recebido do N8N!';
                    setTimeout(() => {
                        showResultsScreen();
                    }, 500);
                } else {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Erro no processamento');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert(`‚ùå Erro ao processar arquivos: ${error.message}\n\nTente novamente.`);
                showUploadScreen();
            }
        });

        function showProcessingScreen() {
            uploadScreen.classList.add('hidden');
            processingScreen.classList.add('active');
            resultsScreen.classList.remove('active');
            processingText.textContent = 'Enviando arquivos para o N8N...';
            processingCounter.textContent = `Aguardando resposta do N8N...`;
        }

        function showResultsScreen() {
            uploadScreen.classList.add('hidden');
            processingScreen.classList.remove('active');
            resultsScreen.classList.add('active');
            
            const totalFiles = processedFiles.length;
            successMessage.textContent = `${totalFiles} arquivo(s) recebido(s) do N8N`;
            
            resultsGrid.innerHTML = processedFiles.map((file, index) => {
                // Define o √≠cone baseado no tipo de arquivo
                let iconColor = 'rgba(59, 130, 246, 0.1)'; // azul padr√£o
                let iconStroke = 'var(--info-color)';
                
                if (file.type && file.type.includes('zip')) {
                    iconColor = 'rgba(147, 51, 234, 0.1)'; // roxo para ZIP
                    iconStroke = '#9333ea';
                } else if (file.name.endsWith('.zip')) {
                    iconColor = 'rgba(147, 51, 234, 0.1)';
                    iconStroke = '#9333ea';
                }
                
                return `
                    <div class="result-item">
                        <div class="result-icon" style="background: ${iconColor};">
                            <svg fill="currentColor" viewBox="0 0 20 20" style="color: ${iconStroke};">
                                <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="result-details">
                            <div class="result-name" title="${file.name}">${file.name}</div>
                            <div class="result-size">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showUploadScreen() {
            uploadScreen.classList.remove('hidden');
            processingScreen.classList.remove('active');
            resultsScreen.classList.remove('active');
        }

        newUploadBtn.addEventListener('click', () => {
            selectedFiles = [];
            processedFiles = [];
            expectedFilesCount = 0;
            showUploadScreen();
            resetForm();
        });

        function resetForm() {
            filesList.classList.remove('active');
            uploadArea.style.display = 'block';
            uploadBtn.disabled = true;
            addMoreBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
            fileCounter.textContent = '0/8';
            uploadBtn.innerHTML = `
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                <span id="uploadBtnText">Processar Arquivos</span>
            `;
            infoAlert.innerHTML = `
                <svg fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
                <span>Adicione at√© 8 arquivos Excel para processamento simult√¢neo!</span>
            `;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
    </script>
</body>
</html>
